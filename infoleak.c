#include <IOKit/IOKitLib.h>
#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

//Get the kernel slide. This syscall is cheating, since it's not
//available to an unprivileged user on an unmodified macOS.  I'm using it here
//since I don't have a infoleak bug to use.
uint64_t get_kernel_slide(void)
{
	int ret;
	size_t size;
	uint64_t slide;

#define	KAS_INFO_KERNEL_TEXT_SLIDE_SELECTOR	(0)	/* returns uint64_t	*/

	size = sizeof(slide);
	ret = syscall(439, KAS_INFO_KERNEL_TEXT_SLIDE_SELECTOR, &slide, &size); //439 = kas_info
	if(ret != 0) {
		printf("kas_info failed\n");
		exit(1);
	}
	return slide;
}
